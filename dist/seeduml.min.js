"use strict";var seeduml=(()=>{var Q=Object.defineProperty;var at=Object.getOwnPropertyDescriptor;var ct=Object.getOwnPropertyNames;var lt=Object.prototype.hasOwnProperty;var ht=(q,n)=>{for(var t in n)Q(q,t,{get:n[t],enumerable:!0})},dt=(q,n,t,e)=>{if(n&&typeof n=="object"||typeof n=="function")for(let i of ct(n))!lt.call(q,i)&&i!==t&&Q(q,i,{get:()=>n[i],enumerable:!(e=at(n,i))||e.enumerable});return q};var pt=q=>dt(Q({},"__esModule",{value:!0}),q);var ut={};ht(ut,{default:()=>ft,initialize:()=>V,renderAll:()=>X,renderSequenceDiagram:()=>U});var O=class{constructor(){this.type="sequence";this.participants=[];this.messages=[];this.activations=[];this.groups=[];this.references=[];this.notes=[];this.dividers=[];this.delays=[];this.spacings=[];this.timeConstraints=[];this.taggedSteps=new Map;this.hideFootbox=!1;this.currentStep=0;this.groupStack=[];this.autonumberConfig=null;this.currentAutonumber=0;this.autoactivateEnabled=!1}setHideFootbox(n){this.hideFootbox=n}addParticipant(n,t,e="participant",i,r,c){let o=this.participants.find(l=>l.name===n);o?(t&&(o.label=t),e!=="participant"&&(o.type=e),i!==void 0&&(o.order=i),r&&(o.color=r),c&&(o.stereotype=c)):(o={name:n,label:t,type:e,order:i,color:r,stereotype:c},this.participants.push(o)),this.groupStack.forEach(l=>{l.participants.includes(n)||l.participants.push(n)})}addMessage(n,t,e,i="arrow",r="default",c,o,l="none"){let s=this.currentStep++;this.addParticipant(n),this.addParticipant(t);let a;return this.autonumberConfig&&(a=this.currentAutonumber.toString(),this.currentAutonumber+=this.autonumberConfig.increment),this.messages.push({from:n,to:t,text:e,type:i,step:s,arrowHead:r,startHead:l,color:c,bidirectional:o,number:a}),this.autoactivateEnabled&&n!==t&&i==="arrow"&&this.activate(t,s,s),s}setAutonumber(n=1,t=1,e){this.autonumberConfig={start:n,increment:t,format:e},this.currentAutonumber=n}setAutoactivate(n){this.autoactivateEnabled=n}destroy(n,t){let e=this.participants.find(i=>i.name===n);e&&(e.destroyedStep=t!==void 0?t:this.currentStep++,this.deactivate(n,e.destroyedStep))}create(n,t){let e=this.participants.find(i=>i.name===n);e&&(e.createdStep=t)}addDivider(n){this.dividers.push({label:n,step:this.currentStep++})}rewindStep(){this.currentStep>0&&this.currentStep--}nextStep(){return this.currentStep++}getCurrentStep(){return this.currentStep}addDelay(n){this.delays.push({text:n,step:this.currentStep++})}addSpacing(n=30){this.spacings.push({height:n,step:this.currentStep++})}setTitle(n){this.title=n}setHeader(n){this.header=n}setFooter(n){this.footer=n}returnMessage(n){let t=[...this.activations].reverse().find(c=>c.endStep===void 0);if(!t)return;let e=t.participantName,i=e;if(t.sourceStep!==void 0){let c=this.messages.find(o=>o.step===t.sourceStep);c&&(i=c.from)}let r=this.addMessage(e,i,n,"dotted","open");this.deactivate(e,r)}addNote(n,t,e,i,r="folder",c){let o=c!==void 0?c:this.currentStep++,l=this.groupStack.length>0?this.groupStack[this.groupStack.length-1]:void 0;return this.notes.push({text:n,position:t,participants:e,step:o,color:i,shape:r,owner:l}),o}activate(n,t=this.currentStep,e,i){this.addParticipant(n);let r=this.activations.filter(c=>c.participantName===n&&c.endStep===void 0).length;this.activations.push({participantName:n,startStep:t,level:r,sourceStep:e,color:i})}deactivate(n,t){this.addParticipant(n);let e=this.activations.filter(i=>i.participantName===n&&i.endStep===void 0).sort((i,r)=>r.level-i.level);if(e.length>0){let i=e[0];i.endStep=t!==void 0?t:this.nextStep()}}startGroup(n,t){let e=this.nextStep(),i={type:n,label:t,startStep:e,sections:[],level:this.groupStack.length,participants:[]};return this.groups.push(i),this.groupStack.push(i),i}addGroupSection(n){let t=this.groupStack[this.groupStack.length-1];t&&t.sections.push({label:n,startStep:this.nextStep()})}endGroup(){let n=this.groupStack.pop();n&&(n.endStep=this.nextStep())}addReference(n,t){let e=this.nextStep(),i=this.nextStep();this.references.push({participants:n,label:t,startStep:e,endStep:i})}addTaggedStep(n,t){this.taggedSteps.set(n,t)}addTimeConstraint(n,t,e){this.timeConstraints.push({startTag:n,endTag:t,label:e})}};var j=class{parse(n){let t=new O,e=n.split(`
`),i=null,r=null,c=-1,o="",l="";for(let s=0;s<e.length;s++){let a=e[s],h=a;if(a=a.trim(),!a||a.startsWith("@")||a.startsWith("!pragma"))continue;if(r){let b=a.toLowerCase();if(b.startsWith("end note")||(b==="end hnote"||b==="endhnote")||(b==="end rnote"||b==="endrnote")||(b==="end bnote"||b==="endbnote")){let W=r.position.toLowerCase(),I;r.participants.length===0&&(W==="right"||W==="left")&&(o||l)&&(r.participants=[W==="right"?l:o],c!==-1&&(I=c));let z=r.text.join(`
`).replace(/\\n/g,`
`);t.addNote(z,r.position,r.participants,r.color,r.shape,I),r=null}else r.text.push(h);continue}if(i){a.toLowerCase().startsWith("end ref")?(t.addReference(i.participants,i.label.join(`
`)),i=null):i.label.push(h);continue}if(a.startsWith("'"))continue;let g=!1;a.startsWith("/")&&(g=!0,a=a.substring(1).trim(),t.rewindStep());let u=a.match(/^create\s+(?:(actor|boundary|control|entity|database|collections)\s+)?(\w+)$/i);if(u){let[,b,x]=u;t.addParticipant(x,b),t.create(x,t.getCurrentStep());continue}let f=a.match(/^(activate|deactivate|destroy)\s+(".*?"|\w+)(?:\s+(#\w+))?$/i);if(f){let[,b,x,H]=f,E=x.replace(/^"(.*)"$/,"$1");if(H&&H.startsWith("#")){let W=H.substring(1);/^[0-9A-Fa-f]+$/.test(W)&&[3,4,6,8].includes(W.length)||(H=W)}let F=b.toLowerCase();F==="activate"?E===l&&c!==-1?t.activate(E,c,c,H):t.activate(E,void 0,void 0,H):F==="deactivate"?(E===l||E===o)&&c!==-1?t.deactivate(E,c):t.deactivate(E):F==="destroy"&&((E===l||E===o)&&c!==-1?t.destroy(E,c):t.destroy(E,t.getCurrentStep()));continue}let m=a.match(/^\{(\w+)\}\s*<->\s*\{(\w+)\}(?:\s*:\s*(.*))?$/);if(m){let[,b,x,H]=m;t.addTimeConstraint(b,x,H||"");continue}let d=a.match(/^\.\.\.(?:\s*(.*?)\s*\.\.\.)?$/);if(d){let[,b]=d;t.addDelay(b||void 0);continue}let p=a.match(/^(?:\{(\w+)\}\s+)?(".*?"|\w+|x|\[|\])?\s*([<ox\\/]*)([-.]+)(?:\[(#\w+)\])?([-.]*)([>ox\\/]*)?\s*(".*?"|\w+|x|\[|\])?\s*(--\+\+|\+\+--|--|\+\+|\*\*|!!)?(?:\s+(#\w+))?(?:\s*:\s*(.*))?$/i);if(p){let[,b,x,H,E,F,W,I,z,N,D,Y]=p;Y=Y||"";let J=E+(W||"");if(J.length>0){x&&(x=x.replace(/^"(.*)"$/,"$1")),z&&(z=z.replace(/^"(.*)"$/,"$1")),(!x||x==="[")&&(x="["),(!z||z==="]")&&(z="]");let rt=J.includes("..")||J.includes("--"),st=H.includes("<")&&(I||"").includes(">"),tt=(C,K)=>C?C===">"||C==="<"?"default":C===">>"||C==="<<"?"open":C==="\\"||C==="/"?"half":C==="\\\\"||C==="//"?"open":C.includes("x")?"lost":C.includes("o")?"arrow-circle":"default":"none",et=tt(I||"",!1),it=tt(H||"",!0);I==="x"&&(et="lost"),x==="x"&&(it="found");let ot=Y.replace(/\\n/g,`
`),G=t.addMessage(x,z,ot,rt?"dotted":"arrow",et,F,st,it);if(b&&t.addTaggedStep(b,G),c=G,o=x,l=z,N==="++"){if(D&&D.startsWith("#")){let C=D.substring(1);/^[0-9A-Fa-f]+$/.test(C)&&[3,4,6,8].includes(C.length)||(D=C)}t.activate(z,G,G,D)}else if(N==="--")t.deactivate(x,G);else if(N==="--++"){if(t.deactivate(x,G),D&&D.startsWith("#")){let C=D.substring(1);/^[0-9A-Fa-f]+$/.test(C)&&[3,4,6,8].includes(C.length)||(D=C)}t.activate(z,G,G,D)}else if(N==="++--"){if(D&&D.startsWith("#")){let C=D.substring(1);/^[0-9A-Fa-f]+$/.test(C)&&[3,4,6,8].includes(C.length)||(D=C)}t.activate(x,G,G,D),t.deactivate(z,G)}else N==="**"?t.create(z,G):N==="!!"&&t.destroy(z,G);continue}}let $=a.match(/^(h|r|b)?note\s+(left|right|over|across)(?:\s+(?:of\s+)?([^#:]+))?\s*(#\w+)?\s*(?::\s*(.*))?$/i);if($){let[,b,x,H,E,F]=$,W=[];H&&H.trim()&&(W=H.split(",").map(z=>z.trim().replace(/^"(.*)"$/,"$1")));let I="folder";if(b==="h"?I="hexagon":b==="r"?I="rectangle":b==="b"&&(I="bubble"),F!==void 0){let z=x.toLowerCase(),N;W.length===0&&(z==="right"||z==="left")&&(o||l)&&(W=[z==="right"?l:o],c!==-1&&(N=c));let D=F.replace(/\\n/g,`
`);t.addNote(D,x.toLowerCase(),W,E,I,N)}else r={text:[],position:x.toLowerCase(),participants:W,color:E,shape:I};continue}let M=a.match(/^(alt|opt|loop|par|break|critical|group)(?:\s+(.*))?$/i);if(M){let[,b,x]=M;t.startGroup(b.toLowerCase(),x||"");continue}let R=a.match(/^else(?:\s+(.*))?$/i);if(R){let[,b]=R;t.addGroupSection(b||"");continue}if(a.toLowerCase().startsWith("end")){t.endGroup();continue}let w=a.match(/^ref\s+over\s+(.*?)(?:\s*:\s*(.*))?$/i);if(w){let[,b,x]=w,H=b.split(",").map(E=>E.trim().replace(/^"(.*)"$/,"$1"));x?t.addReference(H,x):i={participants:H,label:[]};continue}let y=a.match(/^return(?:\s+(.*))?$/i);if(y){let[,b]=y,x=(b||"").replace(/\\n/g,`
`);t.returnMessage(x);continue}let k=a.match(/^autonumber(?:\s+(\d+))?(?:\s+(\d+))?(?:\s+"(.*?)"|)$/i);if(k){let[,b,x,H]=k;t.setAutonumber(b?parseInt(b,10):1,x?parseInt(x,10):1,H);continue}let v=a.match(/^autoactivate\s+(on|off)$/i);if(v){t.setAutoactivate(v[1].toLowerCase()==="on");continue}let S=a.match(/^==\s*(.*?)\s*==$/);if(S){t.addDivider(S[1]);continue}if(a==="|||"){t.addSpacing();continue}let A=a.match(/^\|\|(\d+)\|\|$/);if(A){t.addSpacing(parseInt(A[1],10));continue}let T=a.match(/^(title|header|footer)\s+(.*)$/i);if(T){let[,b,x]=T;b.toLowerCase()==="title"?t.setTitle(x):b.toLowerCase()==="header"?t.setHeader(x):b.toLowerCase()==="footer"&&t.setFooter(x);continue}if(a.toLowerCase()==="hide footbox"){t.setHideFootbox(!0);continue}let L="(participant|actor|boundary|control|entity|database|collections|queue)",P=new RegExp(`^${L}\\s+(".*?"|\\w+)\\s*(?:<<\\s*(.*?)\\s*>>)?(?:\\s+as\\s+(".*?"|\\w+))?\\s*(?:<<\\s*(.*?)\\s*>>)?(?:\\s+order\\s+(\\d+))?(?:\\s+(#\\w+))?$`,"i"),B=a.match(P);if(B){let[,b,x,H,E,F,W,I]=B;if(!b||!x)continue;let z=H||F,N,D;E?E.startsWith('"')?(N=x.replace(/^"(.*)"$/,"$1"),D=E.replace(/^"(.*)"$/,"$1")):(N=E.replace(/^"(.*)"$/,"$1"),D=x.replace(/^"(.*)"$/,"$1")):(N=x.replace(/^"(.*)"$/,"$1"),D=void 0);let Y=W?parseInt(W,10):void 0;t.addParticipant(N,D,b.toLowerCase(),Y,I,z);continue}if(h.trim()!==""&&!h.trim().startsWith("'"))throw new Error(`Syntax error at line ${s+1}: ${a}`)}return t}};var nt={padding:40,participantWidth:120,participantHeight:40,participantGap:180,defaultMessageGap:50,fontSize:14,activationWidth:12,colors:{defaultStroke:"#333333",defaultFill:"#eeeeee",actorFill:"#f8f9fa",noteFill:"#ffffcc",line:"#666666",text:"#000000"},fontFamily:"sans-serif"};var _=class{constructor(n){this.theme=n}calculateLayout(n){let t=[...n.participants].sort((w,y)=>w.order!==void 0&&y.order!==void 0?w.order-y.order:w.order!==void 0?-1:y.order!==void 0?1:0),e=this.calculateMaxStep(n);this.finalizeEndSteps(n,e);let i=this.calculateStepHeights(n,e),r=i.stepY,c=i.totalHeight,o=t.map(w=>this.calculateParticipantWidth(w)),l=this.calculateGaps(n,t,o),s=this.calculateRelativepCenterXs(t,o,l),a=this.preCalculateNoteLayouts(n,t,s,o,r),h=this.calculateBounds(t,s,o,a,n.messages),g=this.theme.padding-h.minX,u=h.maxX-h.minX+this.theme.padding*2,f=u;if(n.timeConstraints.length>0){let y=50+Math.max(...n.timeConstraints.map(k=>k.label.length),0)*8;f+=y}let m=n.hideFootbox?0:this.theme.participantHeight+20,d=c+m+this.theme.padding,p=t.map((w,y)=>{let k=s[y]+g;return{participant:w,centerX:k,x:k-o[y]/2,y:w.createdStep!==void 0?r[w.createdStep]-this.theme.participantHeight/2:this.theme.padding,width:o[y],height:this.theme.participantHeight,destroyedY:w.destroyedStep!==void 0?r[w.destroyedStep]:void 0}}),$=[];a.forEach((w,y)=>{let k=w.x+g,v=w.width;y.position==="across"&&(k=this.theme.padding,v=Math.max(u-this.theme.padding*2,w.width)),$.push({note:y,x:k,y:w.y,width:v,height:w.height})});let M=this.calculateGroupLayouts(n,p,$,r,e),R=this.calculateActivationLayouts(n,p,r,n.messages);return{width:f,height:d,participants:p,notes:$,dividers:this.calculateDividerLayouts(n,r,f),references:this.calculateReferenceLayouts(n,p,r),messages:this.calculateMessageLayouts(n,p,r,R),groups:M,activations:R,delays:this.calculateDelayLayouts(n,r),timeConstraints:this.calculateTimeConstraintLayouts(n,p,r,u)}}calculateMessageLayouts(n,t,e,i){return n.messages.map(r=>{let c=t.findIndex(u=>u.participant.name===r.from),o=t.findIndex(u=>u.participant.name===r.to),l=e[r.step],s=c!==-1?t[c].centerX:0,a=o!==-1?t[o].centerX:0;o!==-1&&t[o].participant.createdStep===r.step&&(a=t[o].x);let h=[{x:s,y:l},{x:a,y:l}],g={x:(s+a)/2,y:l};if(c===o&&c!==-1){let u=i.filter(d=>d.activation.participantName===r.from&&d.activation.startStep<=r.step&&(d.activation.endStep??1/0)>=r.step).sort((d,p)=>p.activation.level-d.activation.level),f=u.length>0?u[0].x+u[0].width:t[c].centerX,m=40;h[0]={x:f,y:l},h[1]={x:f+m,y:l},h.push({x:f+m,y:l+25}),h.push({x:f,y:l+25}),g={x:f+m+5,y:l+10}}return{message:r,y:l,points:h,labelPosition:g,lineStyle:r.type==="dotted"?"dashed":"solid"}})}calculateDividerLayouts(n,t,e){return n.dividers.map(i=>({y:t[i.step],label:i.label}))}calculateDelayLayouts(n,t){return n.delays.map(e=>({y:t[e.step],text:e.text}))}calculateTimeConstraintLayouts(n,t,e,i){return n.timeConstraints.map(r=>{let c=n.taggedSteps.get(r.startTag),o=n.taggedSteps.get(r.endTag);return c===void 0||o===void 0?null:{x:i-this.theme.padding+20,startY:e[c],endY:e[o],label:r.label}}).filter(r=>r!==null)}calculateReferenceLayouts(n,t,e){return n.references.map(i=>{let r=i.participants.map(g=>t.findIndex(u=>u.participant.name===g)).filter(g=>g!==-1);if(r.length===0)return null;let c=Math.min(...r),o=Math.max(...r),l=t[c].x,s=t[o].x+t[o].width-l,a=e[i.startStep]-10,h=e[i.endStep]-a;return{reference:i,x:l,y:a,width:s,height:h}}).filter(i=>i!==null)}calculateActivationLayouts(n,t,e,i){return n.activations.map(r=>{let c=t.findIndex(g=>g.participant.name===r.participantName);if(c===-1)return null;let l=t[c].centerX-this.theme.activationWidth/2+r.level*5,s=e[r.startStep];if(r.sourceStep!==void 0){let g=i.find(u=>u.step===r.sourceStep);g&&g.from===r.participantName&&g.to===r.participantName&&(s+=15)}let a=e[r.endStep];return{activation:r,x:l,y:s,width:this.theme.activationWidth,height:Math.max(5,a-s)}}).filter(r=>r!==null)}calculateMaxStep(n){let t=0;return[...n.messages,...n.activations,...n.groups,...n.references,...n.notes,...n.dividers,...n.delays,...n.spacings].forEach(i=>{let r=i.step??i.startStep??i.endStep??0;r>t&&(t=r)}),t+1}finalizeEndSteps(n,t){n.activations.forEach(e=>{e.endStep===void 0&&(e.endStep=t)}),n.groups.forEach(e=>{e.endStep===void 0&&(e.endStep=t)})}calculateStepHeights(n,t){let e=new Array(t+1).fill(this.theme.defaultMessageGap),i=new Array(t+2).fill(0),r=new Array(t+2).fill(0);n.notes.forEach(s=>{let h=s.text.split(`
`).length*20+10;i[s.step]=Math.max(i[s.step],h/2-10),r[s.step]=Math.max(r[s.step],h/2+10)}),n.messages.forEach(s=>{let h=s.text.split(`
`).length;if(s.from===s.to){let g=Math.max(25,h*20);i[s.step]=Math.max(i[s.step],0),r[s.step]=Math.max(r[s.step],g+10)}else{let g=h*15+5;i[s.step]=Math.max(i[s.step],g),r[s.step]=Math.max(r[s.step],0)}});let c=new Array(t+1).fill(this.theme.defaultMessageGap);n.dividers.forEach(s=>{c[s.step]=30}),n.delays.forEach(s=>{c[s.step]=40}),n.spacings.forEach(s=>{c[s.step]=s.height}),n.references.forEach(s=>{let h=s.label.split(`
`).length*15+40;s.endStep===s.startStep+1&&(c[s.startStep]=Math.max(c[s.startStep],h))});for(let s=0;s<=t;s++){let a=r[s]+i[s+1]+10;e[s]=Math.max(c[s],a)}let o=new Array(t+1).fill(0),l=this.theme.padding+90;for(let s=0;s<=t;s++)o[s]=l,l+=e[s];return{stepY:o,totalHeight:l}}calculateParticipantWidth(n){let e=(n.label||n.name).replace(/\\n/g,`
`).split(`
`),i=Math.max(...e.map(r=>r.length));return Math.max(this.theme.participantWidth,i*9+30)}calculateGaps(n,t,e){let i=Math.max(0,t.length-1),r=new Array(i).fill(60),c=this.calculateMaxStep(n);for(let o=0;o<=c;o++){let l=new Array(i).fill(0);for(let s=0;s<t.length;s++){let a=t[s].name;if(t[s].createdStep===o){let $=e[s];s<i&&(l[s]=Math.max(l[s],$/2+20))}let g=15,u=n.messages.find($=>$.step===o&&$.from===a&&$.to===a);u&&(g=40+(Math.max(...u.text.split(`
`).map(M=>M.length*8))+20)+10);let f=n.activations.filter($=>$.participantName===a&&$.startStep<=o&&($.endStep??1/0)>=o);if(f.length>0){let $=Math.max(...f.map(M=>M.level));g=Math.max(g,this.theme.activationWidth/2+$*5+10)}n.notes.filter($=>$.step===o&&$.position==="right"&&$.participants?.includes(a)).forEach($=>{let M=Math.max(60,Math.max(...$.text.split(`
`).map(R=>R.length*8.5))+20);g+=M+10}),s<i&&(l[s]+=g);let d=15;n.notes.filter($=>$.step===o&&$.position==="left"&&$.participants?.includes(a)).forEach($=>{let M=Math.max(60,Math.max(...$.text.split(`
`).map(R=>R.length*8.5))+20);d+=M+10}),s>0&&(l[s-1]+=d)}for(let s=0;s<i;s++)r[s]=Math.max(r[s],l[s])}return n.messages.forEach(o=>{let l=t.findIndex(f=>f.name===o.from),s=t.findIndex(f=>f.name===o.to);if(l===-1||s===-1||l===s)return;let a=Math.max(...o.text.split(`
`).map(f=>f.length*8))+20,h=Math.min(l,s),g=Math.max(l,s),u=0;for(let f=h;f<g;f++)u+=e[f]/2+r[f]+e[f+1]/2;if(u<a){let m=(a-u)/(g-h);for(let d=h;d<g;d++)r[d]+=m}}),n.notes.forEach(o=>{if(o.position!=="over"&&o.position!=="across")return;let l=o.text.split(`
`),s=Math.max(60,Math.max(...l.map(a=>a.length*8.5))+20);if(o.participants&&o.participants.length>0){let a=t.findIndex(f=>f.name===o.participants[0]),h=o.participants.length>1?t.findIndex(f=>f.name===o.participants[1]):a;if(a===-1||h===-1)return;let g=Math.min(a,h),u=Math.max(a,h);if(g===u){let f=s/2+10;g<i&&r[g]<f&&(r[g]=f)}else{let f=0;for(let m=g;m<u;m++)f+=e[m]/2+r[m]+e[m+1]/2;if(f<s){let d=(s-f)/(u-g);for(let p=g;p<u;p++)r[p]+=d}}}}),r}calculateRelativepCenterXs(n,t,e){let i=new Array(n.length).fill(0);return n.forEach((r,c)=>{c===0?i[c]=t[c]/2:i[c]=i[c-1]+t[c-1]/2+e[c-1]+t[c]/2}),i}preCalculateNoteLayouts(n,t,e,i,r){let c=new Map,o=new Map;return n.notes.forEach(l=>{let s=l.text.split(`
`),a=Math.max(...s.map(d=>d.length*8.5))+20,g=Math.max(a,60),u=s.length*20+10,f=r[l.step]-u/2+10,m=0;if(l.position==="across")m=0,c.set(l,{x:m,y:f,width:g,height:u});else if(l.position==="over"){let d=l.participants.map(p=>t.findIndex($=>$.name===p)).filter(p=>p!==-1);if(d.length>0){let p=Math.min(...d),$=Math.max(...d),M=e[$]+i[$]/2-(e[p]-i[p]/2),R=Math.max(M,g);m=e[p]-i[p]/2-(R-M)/2,c.set(l,{x:m,y:f,width:R,height:u})}}else{let d=(l.participants||[]).map(p=>t.findIndex($=>$.name===p)).filter(p=>p!==-1);if(d.length>0){let p=l.position==="left"?Math.min(...d):Math.max(...d),$=e[p],M=`${l.step}-${p}-${l.position}`,R=i[p]/2;if(l.position==="left")m=(o.get(M)??$-R-5)-g,o.set(M,m-10);else{let w=n.messages.find(L=>L.step===l.step&&L.from===t[p].name&&L.to===t[p].name),y=0;w&&(y=40+(Math.max(...w.text.split(`
`).map(P=>P.length*8))+20));let k=n.activations.filter(L=>L.participantName===t[p].name&&L.startStep<=l.step&&(L.endStep??1/0)>=l.step),v=k.length>0?Math.max(...k.map(L=>L.level)):0,S=this.theme.activationWidth/2+v*5,A=Math.max(R,S,y);m=o.get(M)??$+A+5,o.set(M,m+g+10)}c.set(l,{x:m,y:f,width:g,height:u})}}}),c}calculateBounds(n,t,e,i,r){let c=0,o=0;return n.forEach((l,s)=>{let a=t[s]-e[s]/2,h=t[s]+e[s]/2;s===0?(c=a,o=h):(a<c&&(c=a),h>o&&(o=h))}),i.forEach(l=>{l.x<c&&(c=l.x),l.x+l.width>o&&(o=l.x+l.width)}),r.forEach(l=>{let s=n.findIndex(u=>u.name===l.from),a=n.findIndex(u=>u.name===l.to);if(s===-1||a===-1)return;let h=l.text.split(`
`),g=Math.max(...h.map(u=>u.length*8))+20;if(s===a){let u=t[s],f=Math.max(...l.text.split(`
`).map(d=>d.length*8))+20,m=u+40+f+10;m>o&&(o=m)}else{let u=t[s],f=t[a],m=(u+f)/2,d=m-g/2,p=m+g/2;d<c&&(c=d),p>o&&(o=p)}}),{minX:c,maxX:o}}calculateGroupLayouts(n,t,e,i,r){let c=n.groups.length>0?Math.max(...n.groups.map(o=>o.level)):0;return n.groups.map(o=>{let l=o.participants.map(y=>t.findIndex(k=>k.participant.name===y)).filter(y=>y!==-1);if(l.length===0)return null;let s=Math.min(...l),a=Math.max(...l),h=c-o.level,g=10+h*10,u=25+h*8,f=5+h*8,m=t[s].x+t[s].width/2-t[s].width/2-g,d=t[s].x-g,p=t[a].x+t[a].width+g-d;e.filter(y=>{let k=y.note;if(k.step<o.startStep||k.step>(o.endStep||r))return!1;let v=k.owner;if(!v)return!1;if(v===o)return!0;let S=v.endStep??r,A=o.endStep??r;return v.startStep>=o.startStep&&S<=A}).forEach(y=>{let k=y.note;if(k.position==="right"){let v=(k.participants||[]).map(S=>t.findIndex(A=>A.participant.name===S)).filter(S=>S!==-1);if(v.length>0&&Math.max(...v)===a){let S=y.x+y.width,A=d+p;S+10>A&&(p=S+10-d)}}else if(k.position==="left"){let v=(k.participants||[]).map(S=>t.findIndex(A=>A.participant.name===S)).filter(S=>S!==-1);if(v.length>0&&Math.min(...v)===s){let S=y.x,A=d;if(S-10<A){let T=A-(S-10);d-=T,p+=T}}}});let M=i[o.startStep]-u,R=i[o.endStep]+f,w=o.sections.map(y=>({label:y.label,y:i[y.startStep]}));return{group:o,x:d,y:M,width:p,height:R-M,type:o.type,label:o.label,sections:w}}).filter(o=>o!==null)}};var Z=class{constructor(){this.theme=nt;this.lastSvg="";this.layoutEngine=new _(this.theme)}render(n){this.ensureParticipants(n);let t=this.layoutEngine.calculateLayout(n);return this.generateSvg(n,t)}ensureParticipants(n){n.notes.forEach(t=>{t.participants&&t.participants.forEach(e=>n.addParticipant(e))})}generateSvg(n,t){let e=`<svg width="${t.width}" height="${t.height}" viewBox="0 0 ${t.width} ${t.height}" xmlns="http://www.w3.org/2000/svg" style="background: white; font-family: ${this.theme.fontFamily};">`;return e+=this.renderDefs(n),e+=this.renderLifelines(n,t),e+=this.renderActivations(n,t),e+=this.renderGroups(t),e+=this.renderParticipants(n,t),e+=this.renderReferences(n,t),e+=this.renderNotes(t),e+=this.renderMessages(n,t),e+=this.renderDividers(n,t),e+=this.renderDelays(n,t),e+=this.renderTimeConstraints(t),e+=this.renderDestructionMarks(t),n.title&&(e+=`<text x="${t.width/2}" y="25" text-anchor="middle" font-size="${this.theme.fontSize+4}" font-weight="bold">${n.title}</text>`),n.header&&(e+=`<text x="${t.width-this.theme.padding}" y="15" text-anchor="end" font-size="${this.theme.fontSize-4}">${n.header}</text>`),n.footer&&(e+=`<text x="${t.width/2}" y="${t.height-10}" text-anchor="middle" font-size="${this.theme.fontSize-4}">${n.footer}</text>`),e+="</svg>",e}renderDefs(n){let t=new Set;t.add(this.theme.colors.defaultStroke),n.messages.forEach(i=>{t.add(this.normalizeColor(i.color,this.theme.colors.defaultStroke))});let e="<defs>";return t.forEach(i=>{let r=i.replace("#","");e+=`
      <marker id="arrowhead-${r}" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
        <polygon points="0 0, 10 3.5, 0 7" fill="${i}" />
      </marker>
      <marker id="arrowhead-reverse-${r}" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto">
        <polygon points="10 0, 0 3.5, 10 7" fill="${i}" />
      </marker>
      <marker id="arrowhead-open-${r}" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
        <path d="M 0 0 L 10 3.5 L 0 7" fill="none" stroke="${i}" stroke-width="1" />
      </marker>
      <marker id="arrowhead-open-reverse-${r}" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto">
        <path d="M 10 0 L 0 3.5 L 10 7" fill="none" stroke="${i}" stroke-width="1" />
      </marker>
      <marker id="halfhead-${r}" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
        <polygon points="0 0, 10 3.5, 0 3.5" fill="${i}" />
      </marker>
      <marker id="halfhead-reverse-${r}" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto">
        <polygon points="10 0, 0 3.5, 10 3.5" fill="${i}" />
      </marker>
      <marker id="circlehead-${r}" markerWidth="8" markerHeight="8" refX="4" refY="4" orient="auto">
        <circle cx="4" cy="4" r="3" fill="white" stroke="${i}" stroke-width="1.5" />
      </marker>
      <marker id="arrowhead-circle-${r}" markerWidth="18" markerHeight="7.5" refX="14" refY="3.5" orient="auto">
        <polygon points="0 0, 10 3.5, 0 7" fill="${i}" />
        <circle cx="14" cy="3.5" r="3" fill="${i}" stroke="${i}" stroke-width="1" />
      </marker>
      <marker id="arrowhead-circle-reverse-${r}" markerWidth="18" markerHeight="7.5" refX="4" refY="3.5" orient="auto">
        <polygon points="17 0, 7 3.5, 17 7" fill="${i}" />
        <circle cx="4" cy="3.5" r="3" fill="${i}" stroke="${i}" stroke-width="1" />
      </marker>
      <marker id="losthead-${r}" markerWidth="10" markerHeight="10" refX="5" refY="5" orient="auto">
        <line x1="0" y1="0" x2="10" y2="10" stroke="${i}" stroke-width="2" />
        <line x1="10" y1="0" x2="0" y2="10" stroke="${i}" stroke-width="2" />
      </marker>`}),e+="</defs>",e}renderLifelines(n,t){let e="";return t.participants.forEach(i=>{if(i.participant.name==="["||i.participant.name==="]")return;let r=i.centerX,c=i.destroyedY!==void 0?i.destroyedY:n.hideFootbox?t.height-this.theme.padding:t.height-this.theme.padding-this.theme.participantHeight;e+=`<line x1="${r}" y1="${i.y+i.height}" x2="${r}" y2="${c}" stroke="${this.theme.colors.line}" stroke-dasharray="4" />`}),e}renderDestructionMarks(n){let t="";return n.participants.forEach(e=>{if(e.destroyedY!==void 0){let i=e.centerX,r=e.destroyedY,c=12;t+=`<line x1="${i-c}" y1="${r-c}" x2="${i+c}" y2="${r+c}" stroke="#FF0000" stroke-width="3" />`,t+=`<line x1="${i+c}" y1="${r-c}" x2="${i-c}" y2="${r+c}" stroke="#FF0000" stroke-width="3" />`}}),t}renderParticipants(n,t){let e="",i=(r,c)=>{let o=this.normalizeColor(r.participant.color,this.theme.colors.actorFill),l=r.x,s=c?r.y:t.height-this.theme.padding-this.theme.participantHeight-20,a=r.centerX,h=s+this.theme.participantHeight/2,u=(r.participant.label||r.participant.name).replace(/\\n/g,`
`).split(`
`);switch(r.participant.type){case"actor":e+=`<circle cx="${a}" cy="${s+10}" r="8" fill="${o}" stroke="${this.theme.colors.defaultStroke}" stroke-width="2" />`,e+=`<line x1="${a}" y1="${s+18}" x2="${a}" y2="${s+30}" stroke="${this.theme.colors.defaultStroke}" stroke-width="2" />`,e+=`<line x1="${a-10}" y1="${s+22}" x2="${a+10}" y2="${s+22}" stroke="${this.theme.colors.defaultStroke}" stroke-width="2" />`,e+=`<line x1="${a}" y1="${s+30}" x2="${a-8}" y2="${s+40}" stroke="${this.theme.colors.defaultStroke}" stroke-width="2" />`,e+=`<line x1="${a}" y1="${s+30}" x2="${a+8}" y2="${s+40}" stroke="${this.theme.colors.defaultStroke}" stroke-width="2" />`,u.forEach((L,P)=>{e+=`<text x="${a}" y="${s+55+P*15}" text-anchor="middle" font-size="${this.theme.fontSize}" font-weight="bold">${L}</text>`});break;case"boundary":e+=`<line x1="${a-20}" y1="${h}" x2="${a-10}" y2="${h}" stroke="${this.theme.colors.defaultStroke}" stroke-width="2" />`,e+=`<line x1="${a-20}" y1="${h-10}" x2="${a-20}" y2="${h+10}" stroke="${this.theme.colors.defaultStroke}" stroke-width="2" />`,e+=`<circle cx="${a}" cy="${h}" r="14" fill="${o}" stroke="${this.theme.colors.defaultStroke}" stroke-width="2" />`,u.forEach((L,P)=>{e+=`<text x="${a}" y="${s+this.theme.participantHeight+20+P*15}" text-anchor="middle" font-size="${this.theme.fontSize}" font-weight="bold">${L}</text>`});break;case"control":e+=`<circle cx="${a}" cy="${h}" r="14" fill="${o}" stroke="${this.theme.colors.defaultStroke}" stroke-width="2" />`,e+=`<path d="M ${a+4} ${h-18} L ${a-4} ${h-14} L ${a+4} ${h-10}" fill="none" stroke="${this.theme.colors.defaultStroke}" stroke-width="2" />`,u.forEach((L,P)=>{e+=`<text x="${a}" y="${s+this.theme.participantHeight+20+P*15}" text-anchor="middle" font-size="${this.theme.fontSize}" font-weight="bold">${L}</text>`});break;case"entity":e+=`<circle cx="${a}" cy="${h}" r="14" fill="${o}" stroke="${this.theme.colors.defaultStroke}" stroke-width="2" />`,e+=`<line x1="${a-14}" y1="${h+14}" x2="${a+14}" y2="${h+14}" stroke="${this.theme.colors.defaultStroke}" stroke-width="2" />`,u.forEach((L,P)=>{e+=`<text x="${a}" y="${s+this.theme.participantHeight+20+P*15}" text-anchor="middle" font-size="${this.theme.fontSize}" font-weight="bold">${L}</text>`});break;case"database":let f=34,m=40,d=s,p=a-f/2;e+=`<path d="M ${p} ${d+10} L ${p} ${d+m-10} A 17 8 0 0 0 ${p+f} ${d+m-10} L ${p+f} ${d+10} A 17 8 0 0 0 ${p} ${d+10} M ${p} ${d+10} A 17 8 0 0 1 ${p+f} ${d+10}" fill="${o}" stroke="${this.theme.colors.defaultStroke}" stroke-width="2" />`,e+=`<path d="M ${p} ${d+10} A 17 8 0 0 0 ${p+f} ${d+10}" fill="none" stroke="${this.theme.colors.defaultStroke}" stroke-width="2" />`,u.forEach((L,P)=>{e+=`<text x="${a}" y="${s+this.theme.participantHeight+20+P*15}" text-anchor="middle" font-size="${this.theme.fontSize}" font-weight="bold">${L}</text>`});break;case"collections":let $=34,M=34,R=s+3,w=a-$/2;e+=`<rect x="${w+4}" y="${R-4}" width="${$}" height="${M}" fill="${o}" stroke="${this.theme.colors.defaultStroke}" stroke-width="2" />`,e+=`<rect x="${w}" y="${R}" width="${$}" height="${M}" fill="${o}" stroke="${this.theme.colors.defaultStroke}" stroke-width="2" />`,u.forEach((L,P)=>{e+=`<text x="${a}" y="${s+this.theme.participantHeight+20+P*15}" text-anchor="middle" font-size="${this.theme.fontSize}" font-weight="bold">${L}</text>`});break;case"queue":let y=40,k=40,v=s+3,S=a-y/2,A=5,T=k/2;e+=`<path d="M ${S+y} ${v} L ${S} ${v} A ${A} ${T} 0 0 0 ${S} ${v+k} L ${S+y} ${v+k} A ${A} ${T} 0 0 0 ${S+y} ${v}" fill="${o}" stroke="none" />`,e+=`<ellipse cx="${S+y}" cy="${v+T}" rx="${A}" ry="${T}" fill="${o}" stroke="none" />`,e+=`<path d="M ${S+y} ${v} L ${S} ${v} A ${A} ${T} 0 0 0 ${S} ${v+k} L ${S+y} ${v+k}" fill="none" stroke="${this.theme.colors.defaultStroke}" stroke-width="2" />`,e+=`<ellipse cx="${S+y}" cy="${v+T}" rx="${A}" ry="${T}" fill="none" stroke="${this.theme.colors.defaultStroke}" stroke-width="2" />`,u.forEach((L,P)=>{e+=`<text x="${a}" y="${s+this.theme.participantHeight+20+P*15}" text-anchor="middle" font-size="${this.theme.fontSize}" font-weight="bold">${L}</text>`});break;default:e+=`<rect x="${l}" y="${s}" width="${r.width}" height="${this.theme.participantHeight}" rx="5" fill="${o}" stroke="${this.theme.colors.defaultStroke}" stroke-width="2" />`,u.forEach((L,P)=>{let B=u.length>1?h-(u.length-1)*7.5+P*15:h;e+=`<text x="${a}" y="${B}" text-anchor="middle" dominant-baseline="middle" font-size="${this.theme.fontSize}" font-weight="bold">${L}</text>`})}};return t.participants.forEach(r=>{r.participant.name==="["||r.participant.name==="]"||(i(r,!0),n.hideFootbox||i(r,!1))}),e}renderGroups(n){let t="";return n.groups.forEach(e=>{t+=`<rect x="${e.x}" y="${e.y}" width="${e.width}" height="${e.height}" fill="none" stroke="#222" stroke-width="2" rx="5" />`,t+=`<path d="M ${e.x} ${e.y} L ${e.x+70} ${e.y} L ${e.x+70} ${e.y+10} L ${e.x+60} ${e.y+20} L ${e.x} ${e.y+20} Z" fill="#eee" stroke="#222" stroke-width="2" />`,t+=`<text x="${e.x+5}" y="${e.y+15}" font-size="${this.theme.fontSize-2}" font-weight="bold">${e.type}</text>`,e.label&&(t+=`<text x="${e.x+75}" y="${e.y+15}" font-size="${this.theme.fontSize-2}" font-weight="bold">[${e.label}]</text>`),e.sections.forEach(i=>{let r=i.y;t+=`<line x1="${e.x}" y1="${r}" x2="${e.x+e.width}" y2="${r}" stroke="#222" stroke-width="1" stroke-dasharray="5,5" />`,t+=`<text x="${e.x+5}" y="${r+15}" font-size="${this.theme.fontSize-2}" font-weight="bold">[${i.label}]</text>`})}),t}renderNotes(n){let t="";return n.notes.forEach(e=>{this.drawNoteShape(t,e.x,e.y,e.width,e.height,e.note.shape,e.note.color,e.note.text),t=this.lastSvg}),t}renderActivations(n,t){let e="";return[...t.activations].sort((r,c)=>r.activation.level-c.activation.level).forEach(r=>{let c=r.activation.color||this.theme.colors.actorFill;e+=`<rect x="${r.x}" y="${r.y}" width="${r.width}" height="${r.height}" fill="${c}" stroke="${this.theme.colors.defaultStroke}" stroke-width="1" />`}),e}renderReferences(n,t){let e="";return t.references.forEach(i=>{e+=`<rect x="${i.x}" y="${i.y}" width="${i.width}" height="${i.height}" fill="${this.theme.colors.defaultFill}" stroke="${this.theme.colors.defaultStroke}" stroke-width="2" />`,e+=`<path d="M ${i.x} ${i.y} L ${i.x+70} ${i.y} L ${i.x+70} ${i.y+10} L ${i.x+60} ${i.y+20} L ${i.x} ${i.y+20} Z" fill="#eee" stroke="#222" stroke-width="2" />`,e+=`<text x="${i.x+5}" y="${i.y+12}" font-size="${this.theme.fontSize-2}" font-weight="bold">ref</text>`;let r=i.reference.label.split(`
`),c=this.theme.fontSize+2,o=r.length*c,l=25,s=i.y+i.height/2-o/2+c/2;s<i.y+l+c/2&&(s=i.y+l+c/2),r.forEach((a,h)=>{e+=`<text x="${i.x+i.width/2}" y="${s+h*c}" text-anchor="middle" dominant-baseline="middle" font-size="${this.theme.fontSize}">${a}</text>`})}),e}renderMessages(n,t){let e="";return t.messages.forEach(i=>{let r=i.message,c=this.normalizeColor(r.color,this.theme.colors.defaultStroke),o=i.lineStyle==="dashed"?"4":"0",l=c.replace("#",""),s=(m,d)=>{if(m==="none")return"none";let p="";return m==="default"?p=d?`arrowhead-reverse-${l}`:`arrowhead-${l}`:m==="open"?p=d?`arrowhead-open-reverse-${l}`:`arrowhead-open-${l}`:m==="half"?p=d?`halfhead-reverse-${l}`:`halfhead-${l}`:m==="circle"?p=`circlehead-${l}`:m==="arrow-circle"?p=d?`arrowhead-circle-reverse-${l}`:`arrowhead-circle-${l}`:m==="lost"?p=`losthead-${l}`:m==="found"&&(p=`circlehead-${l}`),p?`url(#${p})`:"none"},a=s(r.arrowHead||"default",!1),h=s(r.startHead||(r.bidirectional?"default":"none"),!0);if(i.points.length>2){let m=`M ${i.points.map(d=>`${d.x} ${d.y}`).join(" L ")}`;e+=`<path d="${m}" fill="none" stroke="${c}" stroke-width="1.5" stroke-dasharray="${o}" marker-end="${a}" marker-start="${h}" />`}else{let[m,d]=i.points;e+=`<line x1="${m.x}" y1="${m.y}" x2="${d.x}" y2="${d.y}" stroke="${c}" stroke-width="1.5" stroke-dasharray="${o}" marker-end="${a}" marker-start="${h}" />`}let u=(r.number?`[${r.number}] ${r.text}`:r.text).split(`
`),f=i.points.length>2?"start":"middle";u.forEach((m,d)=>{let $=i.labelPosition.y-(u.length-1-d)*15-5;i.points.length>2&&($=i.labelPosition.y+d*20),e+=`<text x="${i.labelPosition.x}" y="${$}" text-anchor="${f}" font-size="${this.theme.fontSize-2}" fill="${c}">${m}</text>`})}),e}renderDividers(n,t){let e="";return t.dividers.forEach(i=>{let r=i.y;if(e+=`<line x1="${this.theme.padding}" y1="${r}" x2="${t.width-this.theme.padding}" y2="${r}" stroke="${this.theme.colors.defaultStroke}" stroke-width="1" />`,e+=`<line x1="${this.theme.padding}" y1="${r+4}" x2="${t.width-this.theme.padding}" y2="${r+4}" stroke="${this.theme.colors.defaultStroke}" stroke-width="1" />`,i.label){let c=i.label.length*9+20;e+=`<rect x="${t.width/2-c/2}" y="${r-10}" width="${c}" height="20" fill="white" stroke="${this.theme.colors.defaultStroke}" stroke-width="1" />`,e+=`<text x="${t.width/2}" y="${r}" text-anchor="middle" dominant-baseline="middle" font-size="${this.theme.fontSize-2}" font-weight="bold">${i.label}</text>`}}),e}renderDelays(n,t){let e="";return t.delays.forEach(i=>{let r=i.y,c=t.width/2,o=10,l=5;if(i.text){let s=i.text.length*8+20;e+=`<text x="${c}" y="${r}" text-anchor="middle" dominant-baseline="middle" font-size="${this.theme.fontSize}" fill="${this.theme.colors.text}">${i.text}</text>`;for(let a=0;a<l;a++){let h=c-s/2-10-a*o;e+=`<circle cx="${h}" cy="${r}" r="1.5" fill="${this.theme.colors.text}" />`}for(let a=0;a<l;a++){let h=c+s/2+10+a*o;e+=`<circle cx="${h}" cy="${r}" r="1.5" fill="${this.theme.colors.text}" />`}}else for(let s=-10;s<=10;s++)s!==0&&(e+=`<circle cx="${c+s*o}" cy="${r}" r="1.5" fill="${this.theme.colors.text}" />`)}),e}renderTimeConstraints(n){let t="";return n.timeConstraints.forEach(e=>{let i=e.x,r=e.startY,c=e.endY,o=this.theme.colors.defaultStroke;if(t+=`<line x1="${i}" y1="${r}" x2="${i}" y2="${c}" stroke="${o}" stroke-width="1.5" />`,t+=`<polygon points="${i} ${r}, ${i-4} ${r+8}, ${i+4} ${r+8}" fill="${o}" />`,t+=`<polygon points="${i} ${c}, ${i-4} ${c-8}, ${i+4} ${c-8}" fill="${o}" />`,e.label){let l=(r+c)/2;t+=`<text x="${i+10}" y="${l}" text-anchor="start" dominant-baseline="middle" font-size="${this.theme.fontSize-2}" fill="${o}">${e.label}</text>`}}),t}normalizeColor(n,t){return n?n.startsWith("#")?/^#[0-9a-fA-F]{3,8}$/.test(n)?n:n.substring(1):n:t}formatRichText(n){let t=n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;");return t=t.replace(/\*\*(.*?)\*\*/g,'<tspan font-weight="bold">$1</tspan>'),t=t.replace(/\/\/(.*?)\/\//g,'<tspan font-style="italic">$1</tspan>'),t=t.replace(/""(.*?)""/g,'<tspan font-family="monospace">$1</tspan>'),t=t.replace(/--(.*?)--/g,'<tspan text-decoration="line-through">$1</tspan>'),t=t.replace(/__(.*?)__/g,'<tspan text-decoration="underline">$1</tspan>'),t=t.replace(/~~(.*?)~~/g,'<tspan style="text-decoration: underline; text-decoration-style: wavy">$1</tspan>'),t}drawNoteShape(n,t,e,i,r,c,o,l){let s="",a=this.normalizeColor(o,this.theme.colors.noteFill),h=this.theme.colors.defaultStroke,g=c||"folder";if(g==="hexagon"){let m=[`${t+10},${e}`,`${t+i-10},${e}`,`${t+i},${e+r/2}`,`${t+i-10},${e+r}`,`${t+10},${e+r}`,`${t},${e+r/2}`].join(" ");s+=`<polygon points="${m}" fill="${a}" stroke="${h}" stroke-width="1.5" />`}else if(g==="bubble"){let f=r/2;s+=`<rect x="${t}" y="${e}" width="${i}" height="${r}" rx="${f}" ry="${f}" fill="${a}" stroke="${h}" stroke-width="1.5" />`}else if(g==="rectangle")s+=`<rect x="${t}" y="${e}" width="${i}" height="${r}" fill="${a}" stroke="${h}" stroke-width="1.5" />`;else{let m=`
                M ${t} ${e}
                L ${t+i-10} ${e}
                L ${t+i} ${e+10}
                L ${t+i} ${e+r}
                L ${t} ${e+r}
                Z
            `;s+=`<path d="${m}" fill="${a}" stroke="${h}" stroke-width="1.5" />`;let d=`
                M ${t+i-10} ${e}
                L ${t+i-10} ${e+10}
                L ${t+i} ${e+10}
            `;s+=`<path d="${d}" fill="none" stroke="${h}" stroke-width="1.5" />`}l.split(`
`).forEach((f,m)=>{s+=`<text x="${t+i/2}" y="${e+20+m*20}" text-anchor="middle" font-size="${this.theme.fontSize}" fill="${this.theme.colors.text}">${this.formatRichText(f)}</text>`}),this.lastSvg=n+s}};function U(q){let n=new j,t=new Z;try{let e=n.parse(q);return t.render(e)}catch(e){let r=(e.message||"Unknown error occurred during parsing").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),c=800,o=100;return`
            <svg width="${c}" height="${o}" viewBox="0 0 ${c} ${o}" xmlns="http://www.w3.org/2000/svg" style="background: white; font-family: sans-serif;">
                <rect width="100%" height="100%" fill="#ffeeee" stroke="#ff0000" stroke-width="2" />
                <text x="20" y="50" fill="#ff0000" font-size="16" font-weight="bold">${r}</text>
            </svg>
        `.trim()}}function X(q="pre.seeduml"){if(typeof document>"u")return;document.querySelectorAll(q).forEach(t=>{let e=t.textContent||"",i=U(e),r=document.createElement("div");r.className="seeduml-diagram",r.innerHTML=i,r.style.display="inline-block",t.parentNode?.replaceChild(r,t)})}function V(q={}){let{startOnLoad:n=!0,selector:t="pre.seeduml"}=q;n&&(typeof document>"u"||(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{X(t)}):X(t)))}typeof window<"u"&&(window.seeduml={renderSequenceDiagram:U,renderAll:X,initialize:V});var ft={renderSequenceDiagram:U,renderAll:X,initialize:V};return pt(ut);})();
